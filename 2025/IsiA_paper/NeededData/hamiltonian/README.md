# Hamiltonian Data

This directory contains calculated excitonic Hamiltonian matrices, site energies, and predicted absorption and fluorescence spectra for the IsiA protein complex.

## Overview

The excitonic Hamiltonian describes the electronic coupling between chlorophyll pigments in the IsiA protein. These calculations form the foundation for all subsequent fluorescence decay simulations and spectroscopic predictions.

## Files

### Main Output Files

- **`hamiltonian_matrix.csv`**
  - **Description:** Full 17×17 excitonic Hamiltonian for IsiA monomer
  - **Format:** CSV with comma-separated values
  - **Dimensions:** 17×17 matrix (17 chlorophyll pigments)
  - **Units:** cm⁻¹ (wavenumbers)
  - **Structure:**
    - Diagonal elements: Site energies
    - Off-diagonal elements: Excitonic couplings (V_ij)
  - **Size:** ~5.8 KB
  - **Properties:** Symmetric matrix

- **`absorption_spectrum.csv`**
  - **Description:** Calculated absorption spectrum
  - **Format:** CSV with two columns: Wavelength (nm), Normalized Intensity
  - **Wavelength range:** Typically 600-750 nm
  - **Resolution:** Variable (typically 0.1-1 nm)
  - **Size:** ~9.8 KB
  - **Normalization:** Peak intensity = 1.0

- **`fluorescence_spectrum.csv`**
  - **Description:** Calculated fluorescence emission spectrum
  - **Format:** CSV with two columns: Wavelength (nm), Normalized Intensity
  - **Wavelength range:** Typically 600-750 nm
  - **Resolution:** Variable (typically 0.1-1 nm)
  - **Size:** ~9.8 KB
  - **Normalization:** Peak intensity = 1.0

### Subdirectories

- **`Hamiltonian/`** - Detailed Hamiltonian matrices and intermediate files
  - Alternative formats (NPY, NPZ)
  - Ensemble-averaged Hamiltonians
  - Individual chromophore contributions

- **`SiteEnergy_Data/`** - Site energy calculations for each pigment
  - Individual site energy distributions
  - Statistical analysis of disorder
  - pH-dependent protonation state effects
  - MCCE-derived energies

- **`Spectra_Data/`** - Raw spectral calculation outputs
  - Stick spectra (before broadening)
  - Individual excitonic state contributions
  - Oscillator strengths
  - Transition dipole moments

## Generation Method

All files in this directory are generated by running:

```bash
cd scripts/hamiltonian
python cdc_IsiA_monomer_average_pH7.py
```

**Inputs required:**
- Protein structure: `NeededData/structure/6kig_structure_prepared_mcce_input.pdb`
- MCCE output: `NeededData/mcce/pK.out`
- Protonation state: pH 7.0

**Calculation steps:**
1. Read PDB structure and identify chromophores
2. Extract site energies from MCCE calculations
3. Calculate transition dipole couplings using point-dipole approximation
4. Construct excitonic Hamiltonian matrix
5. Diagonalize to obtain exciton states
6. Calculate absorption and fluorescence spectra using Franck-Condon factors

## Data Format Details

### Hamiltonian Matrix

The Hamiltonian matrix is stored in CSV format:

```csv
14850.2, -45.3, 12.1, ...
-45.3, 14920.5, -23.4, ...
12.1, -23.4, 14765.8, ...
...
```

**Properties:**
- Square symmetric matrix
- Dimension: N × N where N = number of chromophores (17 for IsiA monomer)
- Diagonal: Site energies (εᵢ) in cm⁻¹
- Off-diagonal: Excitonic couplings (Vᵢⱼ) in cm⁻¹

**Loading with NumPy:**
```python
import numpy as np
H = np.loadtxt('NeededData/hamiltonian/hamiltonian_matrix.csv', delimiter=',')
print(f"Hamiltonian shape: {H.shape}")  # (17, 17)
print(f"Site energies: {np.diag(H)}")    # Diagonal elements
```

### Spectral Data

CSV files with two columns:

```csv
Wavelength (nm), Intensity (a.u.)
600.0, 0.023
600.5, 0.034
601.0, 0.045
...
```

**Loading with NumPy:**
```python
import numpy as np
import matplotlib.pyplot as plt

# Load absorption spectrum
wl_abs, intensity_abs = np.loadtxt('NeededData/hamiltonian/absorption_spectrum.csv',
                                     delimiter=',', unpack=True, skiprows=1)

# Load fluorescence spectrum
wl_fl, intensity_fl = np.loadtxt('NeededData/hamiltonian/fluorescence_spectrum.csv',
                                   delimiter=',', unpack=True, skiprows=1)

# Plot both spectra
plt.figure(figsize=(10, 6))
plt.plot(wl_abs, intensity_abs, label='Absorption', linewidth=2)
plt.plot(wl_fl, intensity_fl, label='Fluorescence', linewidth=2)
plt.xlabel('Wavelength (nm)')
plt.ylabel('Intensity (a.u.)')
plt.legend()
plt.title('Calculated Spectra of IsiA Monomer')
plt.grid(True, alpha=0.3)
plt.show()
```

## Physical Interpretation

### Site Energies (Diagonal Elements)

- **Typical range:** 14500-15500 cm⁻¹ (~645-690 nm)
- **Red-shifted sites:** Lower energy (<14800 cm⁻¹, >675 nm)
- **Blue-shifted sites:** Higher energy (>15200 cm⁻¹, <658 nm)
- **Sources of variation:**
  - Local protein environment
  - Protonation states of nearby residues
  - Hydrogen bonding to chlorophyll
  - Axial ligand identity

### Excitonic Couplings (Off-Diagonal Elements)

- **Typical range:** -100 to +100 cm⁻¹
- **Sign convention:**
  - Positive: Energy-raising coupling
  - Negative: Energy-lowering coupling
- **Magnitude factors:**
  - Distance between chromophores (R⁻³ dependence)
  - Relative orientation of transition dipoles
  - κ² orientation factor

### Absorption Spectrum

- **Peak position:** Reflects Hamiltonian eigenvalues
- **Bandwidth:** Includes homogeneous and inhomogeneous broadening
- **Shape:** Sum of transitions weighted by oscillator strengths
- **Blue-side:** Higher energy exciton states
- **Red-side:** Lower energy exciton states

### Fluorescence Spectrum

- **Red-shifted:** Relative to absorption (Stokes shift)
- **Origin:** Emission from relaxed S₁ state
- **Shape:** Reflects lowest exciton state character
- **Quantum yield:** Not explicitly calculated (set to 1.0)

## Relationship to Other Data

### Structure Files (Input)
- **PDB:** `NeededData/structure/6kig_structure_prepared_mcce_input.pdb`
- **Chromophore coordinates:** Extracted from PDB
- **Protein environment:** Affects site energies

### MCCE Data (Input)
- **pK.out:** `NeededData/mcce/pK.out`
- **Site energies:** Derived from MCCE electrostatic calculations
- **Protonation states:** pH 7.0 most occupied conformers

### Fluorescence Simulations (Output → Next Step)
- **Hamiltonian → Dynamics:** Used in all fluorescence decay models
- **Scripts:** `scripts/fluorescence_decay/model_*/`
- **Usage:** Defines energy landscape for excitation dynamics

## Computational Details

### Parameters Used

| Parameter | Value | Description |
|-----------|-------|-------------|
| `E_0a` | ~14800 cm⁻¹ | Reference energy A |
| `E_0b` | ~14800 cm⁻¹ | Reference energy B |
| `dielc` | 2-4 | Effective dielectric constant |
| `T` | 300 K | Temperature |
| `linewidth` | 100-200 cm⁻¹ | Spectral broadening |

### Approximations

- **Point-dipole:** Couplings calculated using point-dipole approximation
- **Franck-Condon:** Vertical transitions (no vibrational structure)
- **Static disorder:** Site energy disorder included
- **No relaxation:** Absorption calculated at Franck-Condon geometry

### Validation

- **Absorption peak:** Should match experimental ~680 nm
- **Bandwidth:** Should approximate experimental linewidth
- **Red states:** Presence of low-energy states crucial for quenching
- **Coupling strengths:** Consistent with inter-pigment distances

## File Metadata

| File | Generated | Size | Format | Checksum |
|------|-----------|------|--------|----------|
| `hamiltonian_matrix.csv` | Nov 6, 2024 | 5.8 KB | CSV | [To be added] |
| `absorption_spectrum.csv` | Nov 6, 2024 | 9.8 KB | CSV | [To be added] |
| `fluorescence_spectrum.csv` | Nov 6, 2024 | 9.8 KB | CSV | [To be added] |

## Data Quality

### Validation Checks

- **Matrix symmetry:** H = H^T (verified)
- **Coupling magnitude:** |V_ij| < 200 cm⁻¹ (physical limit)
- **Site energy range:** 14000-16000 cm⁻¹ (reasonable for Chl a)
- **Spectral shape:** Smooth, physically reasonable

### Known Issues

- Approximations in point-dipole coupling (okay for R > 10 Å)
- Static site energies (dynamic disorder not included)
- No explicit vibronic structure

## Usage Examples

### Example 1: Diagonalize Hamiltonian

```python
import numpy as np

# Load Hamiltonian
H = np.loadtxt('NeededData/hamiltonian/hamiltonian_matrix.csv', delimiter=',')

# Diagonalize
eigenvalues, eigenvectors = np.linalg.eigh(H)

# Sort by energy (lowest first)
idx = np.argsort(eigenvalues)
eigenvalues = eigenvalues[idx]
eigenvectors = eigenvectors[:, idx]

print("Exciton state energies (cm⁻¹):")
print(eigenvalues)

# Identify red states (lowest 20% of energies)
n_red = int(0.2 * len(eigenvalues))
red_states = eigenvalues[:n_red]
print(f"\nRed state energies: {red_states}")
```

### Example 2: Analyze Localization

```python
import numpy as np
import matplotlib.pyplot as plt

# Load Hamiltonian and diagonalize
H = np.loadtxt('NeededData/hamiltonian/hamiltonian_matrix.csv', delimiter=',')
eigenvalues, eigenvectors = np.linalg.eigh(H)
idx = np.argsort(eigenvalues)
eigenvectors = eigenvectors[:, idx]

# Calculate participation ratio for each state
# PR = 1 / sum(c_i^4) where c_i are eigenvector coefficients
PR = np.zeros(len(eigenvalues))
for i in range(len(eigenvalues)):
    c_squared = eigenvectors[:, i]**2
    PR[i] = 1.0 / np.sum(c_squared**2)

# Plot localization
plt.figure(figsize=(10, 6))
plt.bar(range(len(PR)), PR)
plt.xlabel('Exciton State Index')
plt.ylabel('Participation Ratio')
plt.title('Exciton State Localization (Higher = More Delocalized)')
plt.axhline(y=1, color='r', linestyle='--', label='Fully localized')
plt.axhline(y=len(eigenvalues), color='g', linestyle='--', label='Fully delocalized')
plt.legend()
plt.show()
```

### Example 3: Compare with Experiment

```python
import numpy as np
import matplotlib.pyplot as plt

# Load calculated absorption
wl_calc, abs_calc = np.loadtxt('NeededData/hamiltonian/absorption_spectrum.csv',
                                delimiter=',', unpack=True, skiprows=1)

# Load experimental absorption
abs_exp = np.load('NeededData/Experimental_Data/Abs_IsiA_monomer_300K_Gabriela.npy')
# Assuming abs_exp is (wavelength, intensity) or just intensity

# Plot comparison
plt.figure(figsize=(10, 6))
plt.plot(wl_calc, abs_calc, '-', label='Calculated', linewidth=2)
# plt.plot(wl_exp, abs_exp, 'o', label='Experimental', alpha=0.6)
plt.xlabel('Wavelength (nm)')
plt.ylabel('Absorbance (a.u.)')
plt.title('Calculated vs Experimental Absorption')
plt.legend()
plt.grid(True, alpha=0.3)
plt.show()
```

## Reproducibility

To regenerate these files:

1. Ensure input files are present:
   - `NeededData/structure/6kig_structure_prepared_mcce_input.pdb`
   - `NeededData/mcce/pK.out`

2. Run the Hamiltonian calculation:
   ```bash
   cd scripts/hamiltonian
   python cdc_IsiA_monomer_average_pH7.py
   ```

3. Verify outputs match expected ranges:
   - Site energies: 14500-15500 cm⁻¹
   - Couplings: -100 to +100 cm⁻¹
   - Absorption peak: ~680 nm

## Citation

If you use this Hamiltonian data, please cite:

Mohamed A. A. Elrefaiy, Dvir Harris, Hila Toporik, Christopher J. Gisriel, Yuval Mazor, Doran I. G. B. Raccah, and Gabriela S. Schlau-Cohen. "Quenching of the Photosynthetic Antenna IsiA is Facilitated by its Red-Emitting States." *Manuscript in preparation*, 2025.

## Related Documentation

- **Data dictionary:** [../DATA_DICTIONARY.md](../DATA_DICTIONARY.md)
- **Structure files:** [../structure/README.md](../structure/README.md)
- **MCCE data:** [../mcce/README.md](../mcce/README.md)
- **Main README:** [../../README.md](../../README.md)

---

*Last updated: January 26, 2025*
